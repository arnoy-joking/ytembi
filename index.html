<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OmniPlayer Ultimate v7.1 (Live Lockdown)</title>
    <style>
        :root {
            --primary: #ff0033;
            --primary-glow: rgba(255, 0, 51, 0.4);
            --bg: #0a0a0c;
            --surface: #16161a;
            --surface-hover: #1f1f26;
            --text: #ffffff;
            --text-dim: #9494a5;
            --border: #2d2d3a;
            --radius: 16px;
            --font: 'Inter', system-ui, sans-serif;
            --ease: cubic-bezier(0.4, 0, 0.2, 1);
        }

        * { box-sizing: border-box; outline: none; }
        body { 
            margin: 0; background: var(--bg); color: var(--text); 
            font-family: var(--font); height: 100vh; overflow: hidden; 
        }

        .app {
            display: grid;
            grid-template-columns: 1fr 380px;
            grid-template-rows: 64px 1fr;
            height: 100vh;
            transition: all 0.4s var(--ease);
        }

        header {
            grid-column: 1 / -1;
            background: rgba(10, 10, 12, 0.8);
            border-bottom: 1px solid var(--border);
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 24px; z-index: 100; backdrop-filter: blur(12px);
        }
        .logo { font-weight: 800; font-size: 1.3rem; display: flex; align-items: center; gap: 10px; }
        .logo span { color: var(--primary); text-shadow: 0 0 15px var(--primary-glow); }

        .stage {
            grid-column: 1; grid-row: 2;
            padding: 40px; display: flex; flex-direction: column; 
            align-items: center; overflow-y: auto; position: relative;
        }

        .video-container {
            width: 100%; max-width: 1000px;
            aspect-ratio: 16/9; background: #000;
            border-radius: var(--radius);
            box-shadow: 0 30px 60px -12px rgba(0,0,0,0.7);
            overflow: hidden; position: relative;
            border: 1px solid var(--border);
        }
        #player { width: 100%; height: 100%; }

        /* লাইভ মোড স্টাইল */
        .live-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 999; display: none; cursor: not-allowed;
            background: rgba(0,0,0,0); 
        }
        .live-indicator {
            position: absolute; top: 20px; left: 20px;
            background: var(--primary); color: white;
            padding: 6px 14px; border-radius: 6px; font-weight: 900;
            font-size: 12px; display: flex; align-items: center; gap: 8px;
            animation: pulse 1.5s infinite; pointer-events: none;
            box-shadow: 0 4px 15px var(--primary-glow);
        }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }

        .controls-area {
            margin-top: 30px; width: 100%; max-width: 700px;
            display: flex; flex-direction: column; gap: 15px;
        }
        .input-group { display: flex; gap: 10px; }
        .url-input {
            flex: 1; background: var(--surface); border: 1px solid var(--border);
            color: var(--text); padding: 16px 20px; border-radius: 12px;
            font-size: 1rem; transition: 0.3s;
        }

        .btn {
            background: var(--surface); color: var(--text); border: 1px solid var(--border);
            padding: 10px 20px; border-radius: 10px; cursor: pointer; font-weight: 600;
            transition: 0.2s; display: flex; align-items: center; gap: 8px;
        }
        .btn-primary { background: var(--primary); border: none; padding: 0 30px; }
        
        /* সাইডবার */
        .sidebar {
            grid-column: 2; grid-row: 2; background: var(--surface);
            border-left: 1px solid var(--border); display: flex; flex-direction: column;
        }
        .panel { padding: 24px; border-bottom: 1px solid var(--border); }
        .settings-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .toggle-card {
            background: var(--bg); border: 1px solid var(--border);
            padding: 10px; border-radius: 8px; display: flex; align-items: center; 
            gap: 8px; cursor: pointer; font-size: 0.8rem;
        }

        .history-list { list-style: none; padding: 0; margin: 0; flex: 1; overflow-y: auto; }
        .history-item {
            display: flex; gap: 15px; padding: 15px 24px; border-bottom: 1px solid var(--border);
            cursor: pointer; transition: 0.2s;
        }
        .history-item.active { background: rgba(255,0,51,0.05); border-left: 4px solid var(--primary); }

        body.live-active .live-overlay { display: block; }
        body.live-active .url-input, body.live-active .btn-primary { opacity: 0.5; pointer-events: none; }

        .toast {
            position: fixed; bottom: 40px; left: 50%; transform: translateX(-50%);
            background: white; color: black; padding: 12px 24px; border-radius: 50px;
            font-weight: 700; opacity: 0; pointer-events: none; transition: 0.4s; z-index: 2000;
        }
        .toast.show { opacity: 1; transform: translateX(-50%) translateY(-10px); }
    </style>
</head>
<body>

<div class="app">
    <header>
        <div class="logo"><span>◆</span> OmniPlayer </div>
        <div style="display:flex; gap:10px;">
            <button class="btn" id="liveToggleBtn" style="border-color: var(--primary); color: var(--primary);">Live Mode</button>
            <button class="btn" id="theatreBtn">Theatre [T]</button>
        </div>
    </header>

    <main class="stage">
        <div class="video-container">
            <div id="player"></div>
            <div class="live-overlay" id="liveOverlay">
                <div class="live-indicator">● LIVE CLASS LOCKDOWN</div>
            </div>
        </div>
        <div class="controls-area">
            <div class="input-group">
                <input type="text" id="urlInput" class="url-input" placeholder="YouTube Link or ID...">
                <button class="btn btn-primary" id="playBtn">Play</button>
            </div>
        </div>
    </main>

    <aside class="sidebar">
        <div class="panel">
            <h3>Configuration</h3>
            <div class="settings-grid">
                <label class="toggle-card"><input type="checkbox" id="cfg-auto" checked> Autoplay</label>
                <label class="toggle-card"><input type="checkbox" id="cfg-mute"> Mute</label>
            </div>
        </div>
        <ul class="history-list" id="historyList"></ul>
    </aside>
</div>

<div class="toast" id="toast"></div>

<script src="https://www.youtube.com/iframe_api"></script>
<script>
    const DB_KEY = 'omni_v7_data';
    let db = JSON.parse(localStorage.getItem(DB_KEY)) || { history: {}, lastVideo: null, liveMode: false, liveVideoId: null };
    let player = null;
    let saveInterval = null;
    let currentVideoId = null;

    function onYouTubeIframeAPIReady() {
        if (db.liveMode && db.liveVideoId) {
            activateLiveModeUI(true);
            loadVideo(db.liveVideoId);
        } else if (db.lastVideo) {
            loadVideo(db.lastVideo);
        }
    }

    function parseId(input) {
        const match = input.match(/(?:youtu\.be\/|youtube\.com\/(?:.*v=|\/embed\/|\/v\/))([^?&]+)/);
        return match ? match[1] : (input.length === 11 ? input : null);
    }

    function loadVideo(id) {
        if (!id) return;
        currentVideoId = id;
        db.lastVideo = id;
        saveDb();

        let startPos = (db.history[id]) ? Math.floor(db.history[id].position) : 0;
        if (player) { player.destroy(); clearInterval(saveInterval); }

        player = new YT.Player('player', {
            videoId: id,
            playerVars: {
                autoplay: 1,
                controls: db.liveMode ? 0 : 1,
                start: startPos,
                modestbranding: 1
            },
            events: {
                'onReady': () => { startTracking(); },
                'onStateChange': (e) => {
                    if (e.data === YT.PlayerState.ENDED && db.liveMode) exitLiveMode();
                }
            }
        });
        renderHistory();
    }

    function startTracking() {
        clearInterval(saveInterval);
        saveInterval = setInterval(() => {
            if (player?.getCurrentTime) {
                const pos = player.getCurrentTime();
                const dur = player.getDuration();
                if (dur > 0) {
                    db.history[currentVideoId] = { id: currentVideoId, position: pos, duration: dur, updated: Date.now() };
                    saveDb();
                    renderHistory();
                }
            }
        }, 3000);
    }

    function toggleLiveMode() {
        if (!currentVideoId) return showToast("Play a video first");
        if (!db.liveMode) {
            if (confirm("Live Mode will block ALL controls (Keyboard + Mouse). Continue?")) {
                db.liveMode = true;
                db.liveVideoId = currentVideoId;
                saveDb();
                activateLiveModeUI(true);
                loadVideo(currentVideoId);
            }
        } else {
            showToast("Cannot exit until class ends");
        }
    }

    function exitLiveMode() {
        db.liveMode = false;
        db.liveVideoId = null;
        saveDb();
        activateLiveModeUI(false);
        loadVideo(currentVideoId);
        showToast("Class Completed!");
    }

    function activateLiveModeUI(active) {
        document.body.classList.toggle('live-active', active);
        document.getElementById('liveToggleBtn').innerText = active ? "LIVE ACTIVE" : "Live Mode";
    }

    // --- Keyboard Interceptor ---
    document.addEventListener('keydown', (e) => {
        if (db.liveMode) {
            const blocked = [' ', 'arrowleft', 'arrowright', 'arrowup', 'arrowdown', 'j', 'k', 'l', 'f', 'm', '0','1','2','3','4','5','6','7','8','9'];
            if (blocked.includes(e.key.toLowerCase())) {
                e.preventDefault();
                showToast("Locked: Seeking disabled in Live Mode");
            }
        }
    }, true);

    function saveDb() { localStorage.setItem(DB_KEY, JSON.stringify(db)); }
    function showToast(m) { const t=document.getElementById('toast'); t.innerText=m; t.classList.add('show'); setTimeout(()=>t.classList.remove('show'),3000); }
    
    function renderHistory() {
        const list = document.getElementById('historyList');
        list.innerHTML = '';
        Object.values(db.history).sort((a,b)=>b.updated-a.updated).forEach(item => {
            const li = document.createElement('li');
            li.className = `history-item ${currentVideoId === item.id ? 'active' : ''}`;
            li.innerHTML = `<div>${item.id}</div><small>${Math.floor(item.position/60)}m / ${Math.floor(item.duration/60)}m</small>`;
            li.onclick = () => !db.liveMode && loadVideo(item.id);
            list.appendChild(li);
        });
    }

    document.getElementById('playBtn').onclick = () => {
        const id = parseId(document.getElementById('urlInput').value);
        if (id) loadVideo(id);
    };
    document.getElementById('liveToggleBtn').onclick = toggleLiveMode;
</script>
</body>
</html>
