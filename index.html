<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>OmniPlayer Pro: Continue Watching</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" />
  <style>
    :root {
      --primary: #ff0000;
      --primary-dark: #cc0000;
      --bg-light: #ffffff;
      --surface-light: #ffffff;
      --text-light: #111827;
      --border-light: #e5e7eb;
      --shadow-light: 0 4px 12px rgba(0, 0, 0, 0.05);
      --radius: 16px;
      --font: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      --prog-bar-bg: #e5e7eb;
      --prog-bar-fill: var(--primary);
      --success: #10b981;
      --danger: #ef4444;
    }

    [data-theme='dark'] {
      --bg: #0f0f0f;
      --surface: #1a1a1a;
      --text: #f9fafb;
      --border: #374151;
      --prog-bar-bg: #4b5563;
      --shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
    }

    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: var(--font);
      background: var(--bg, var(--bg-light));
      color: var(--text, var(--text-light));
      transition: background 0.3s ease, color 0.3s ease;
      min-height: 100vh;
      padding: 0;
    }

    .container {
      max-width: 1280px;
      margin: 0 auto;
      padding: 24px;
      display: grid;
      grid-template-columns: 2fr 1fr;
      gap: 24px;
      min-height: 100vh;
    }

    @media (max-width: 900px) {
      .container {
        grid-template-columns: 1fr;
        padding: 16px;
      }
    }

    header {
      grid-column: 1 / -1;
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    h1 {
      font-weight: 700;
      font-size: 1.75rem;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    h1 span {
      color: var(--primary);
    }

    .theme-toggle {
      background: none;
      border: none;
      cursor: pointer;
      font-size: 1.4rem;
      padding: 6px;
      border-radius: 50%;
      transition: background 0.2s;
    }

    .theme-toggle:hover {
      background: var(--border, var(--border-light));
    }

    .player-section {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    /* Video Area */
    .video-wrapper {
      position: relative;
      padding-bottom: 56.25%;
      height: 0;
      background: #000;
      border-radius: var(--radius);
      overflow: hidden;
      box-shadow: var(--shadow, var(--shadow-light));
    }

    #player {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }

    /* Input Area */
    .input-group {
      display: flex;
      gap: 12px;
      background: var(--surface, var(--surface-light));
      padding: 18px;
      border-radius: var(--radius);
      border: 1px solid var(--border, var(--border-light));
      box-shadow: var(--shadow, var(--shadow-light));
    }

    .url-input {
      flex: 1;
      padding: 12px 16px;
      border: 1px solid var(--border, var(--border-light));
      border-radius: 10px;
      background: var(--bg, var(--bg-light));
      color: var(--text, var(--text-light));
      font-size: 1rem;
      transition: border-color 0.2s;
    }

    .url-input:focus {
      border-color: var(--primary);
    }

    .btn {
      padding: 0 24px;
      border: none;
      border-radius: 10px;
      font-weight: 600;
      cursor: pointer;
      color: white;
      background: var(--primary);
      font-size: 1rem;
      transition: background 0.2s, transform 0.1s;
    }

    .btn:hover {
      background: var(--primary-dark);
    }

    .btn:active {
      transform: scale(0.98);
    }

    .btn-sec {
      background: var(--border, var(--border-light));
      color: var(--text, var(--text-light));
    }

    .btn-sec:hover {
      background: #d1d5db;
    }

    /* Sidebar */
    .sidebar {
      display: flex;
      flex-direction: column;
      gap: 24px;
    }

    .panel {
      background: var(--surface, var(--surface-light));
      border-radius: var(--radius);
      padding: 24px;
      border: 1px solid var(--border, var(--border-light));
      box-shadow: var(--shadow, var(--shadow-light));
    }

    .panel h3 {
      margin: 0 0 18px 0;
      font-size: 1.125rem;
      font-weight: 600;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .panel-header-actions {
      display: flex;
      gap: 8px;
    }

    /* Settings Grid */
    .settings-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .setting-item {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 0.9rem;
    }

    .setting-item.full {
      grid-column: 1 / -1;
    }

    input[type='checkbox'] {
      accent-color: var(--primary);
      cursor: pointer;
      width: 18px;
      height: 18px;
    }

    input[type='number'] {
      width: 100%;
      padding: 8px 12px;
      background: var(--bg, var(--bg-light));
      color: var(--text, var(--text-light));
      border: 1px solid var(--border, var(--border-light));
      border-radius: 8px;
      font-size: 0.9rem;
    }

    /* History */
    .history-list {
      list-style: none;
      padding: 0;
      margin: 0;
      max-height: 420px;
      overflow-y: auto;
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .history-item {
      padding: 14px;
      border-radius: 10px;
      cursor: pointer;
      display: flex;
      gap: 14px;
      align-items: center;
      transition: background 0.2s;
      position: relative;
      border: 1px solid transparent;
    }

    .history-item:hover {
      background: var(--bg, var(--bg-light));
    }

    .history-item.watching-now {
      border-left: 4px solid var(--primary);
      background: rgba(255, 0, 0, 0.05);
    }

    [data-theme='dark'] .history-item.watching-now {
      background: rgba(255, 0, 0, 0.1);
    }

    .history-thumb {
      width: 90px;
      height: 68px;
      object-fit: cover;
      border-radius: 8px;
      flex-shrink: 0;
      background: #000;
    }

    .history-info {
      flex: 1;
      overflow: hidden;
      display: flex;
      flex-direction: column;
      justify-content: center;
    }

    .history-title {
      font-size: 0.95rem;
      font-weight: 600;
      margin-bottom: 6px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .history-meta {
      font-size: 0.8rem;
      color: #9ca3af;
      display: flex;
      justify-content: space-between;
      white-space: nowrap;
    }

    .history-progress-bg {
      height: 5px;
      background: var(--prog-bar-bg);
      width: 100%;
      margin-top: 8px;
      border-radius: 3px;
      overflow: hidden;
    }

    .history-progress-fill {
      height: 100%;
      background: var(--prog-bar-fill);
      width: 0%;
      transition: width 0.4s ease;
      border-radius: 3px;
    }

    .btn-del {
      color: var(--danger);
      font-size: 1.3rem;
      padding: 0 6px;
      cursor: pointer;
      opacity: 0.7;
      transition: opacity 0.2s;
    }

    .btn-del:hover {
      opacity: 1;
    }

    /* Status Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      left: 50%;
      transform: translateX(-50%);
      background: #1f2937;
      color: white;
      padding: 12px 24px;
      border-radius: 9999px;
      opacity: 0;
      transition: opacity 0.3s, bottom 0.3s;
      pointer-events: none;
      z-index: 999;
      font-size: 0.95rem;
      font-weight: 500;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);
    }

    .toast.show {
      opacity: 1;
      bottom: 40px;
    }

    /* Scrollbar */
    .history-list::-webkit-scrollbar {
      width: 6px;
    }

    .history-list::-webkit-scrollbar-track {
      background: transparent;
    }

    .history-list::-webkit-scrollbar-thumb {
      background: #888;
      border-radius: 3px;
    }

    .history-list::-webkit-scrollbar-thumb:hover {
      background: #aaa;
    }

    /* Loading states / placeholders */
    .placeholder-thumb {
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: shimmer 1.5s infinite;
    }

    @keyframes shimmer {
      0% { background-position: -200% 0; }
      100% { background-position: 200% 0; }
    }

    /* Panel title styling */
    .panel h3 .btn-sec {
      padding: 4px 10px;
      font-size: 0.75rem;
      font-weight: 500;
    }
  </style>
</head>
<body>
  <div class="container">
    <header>
      <h1><span>â–¶</span> OmniPlayer Pro</h1>
      <button class="theme-toggle" id="themeBtn">ðŸŒ™</button>
    </header>

    <main class="player-section">
      <div class="video-wrapper">
        <div id="player"></div>
      </div>

      <div class="input-group">
        <input type="text" id="urlInput" class="url-input" placeholder="Paste YouTube Link or Video ID (e.g. dQw4w9WgXcQ)" />
        <button class="btn" id="loadBtn">â–¶ Play</button>
      </div>

      <div class="panel">
        <h3>Now Playing</h3>
        <div id="statusDisplay" style="font-size: 0.95rem; color: #6b7280;">No video loaded. Paste a YouTube URL to begin.</div>
      </div>
    </main>

    <aside class="sidebar">
      <div class="panel">
        <h3>
          Playback Settings
          <span class="panel-header-actions">
            <button class="btn btn-sec" onclick="resetDefaults()">Reset</button>
          </span>
        </h3>
        <div class="settings-grid">
          <div class="setting-item">
            <input type="checkbox" id="autoplay" checked />
            <label for="autoplay">Autoplay</label>
          </div>
          <div class="setting-item">
            <input type="checkbox" id="loop" />
            <label for="loop">Loop</label>
          </div>
          <div class="setting-item">
            <input type="checkbox" id="controls" checked />
            <label for="controls">Player Controls</label>
          </div>
          <div class="setting-item">
            <input type="checkbox" id="modest" />
            <label for="modest">Minimal UI</label>
          </div>
          <div class="setting-item full">
            <label for="startOverride" style="flex: 1;">Start at (seconds)</label>
            <input type="number" id="startOverride" placeholder="e.g. 300" min="0" />
          </div>
        </div>
        <button class="btn btn-sec" style="width: 100%; margin-top: 16px;" id="applyBtn">Apply & Reload</button>
      </div>

      <div class="panel">
        <h3>
          Watch History
          <span class="panel-header-actions">
            <button class="btn btn-sec" onclick="wipeHistory()">Clear All</button>
          </span>
        </h3>
        <ul class="history-list" id="historyList">
          <li style="padding:14px; text-align:center; color:#9ca3af; font-size:0.9rem;">No viewing history yet.</li>
        </ul>
      </div>
    </aside>
  </div>

  <div class="toast" id="toast">Welcome to OmniPlayer Pro</div>

  <!-- YouTube IFrame API -->
  <script src="https://www.youtube.com/iframe_api"></script>

  <script>
    // --- Global State ---
    let player;
    let saveInterval;
    let currentState = {
      videoId: '',
      history: {}
    };

    const els = {
      input: document.getElementById('urlInput'),
      status: document.getElementById('statusDisplay'),
      historyList: document.getElementById('historyList'),
      settings: {
        autoplay: document.getElementById('autoplay'),
        loop: document.getElementById('loop'),
        controls: document.getElementById('controls'),
        modest: document.getElementById('modest'),
        start: document.getElementById('startOverride')
      }
    };

    // --- Theme Toggle ---
    document.getElementById('themeBtn').addEventListener('click', () => {
      const isDark = document.body.getAttribute('data-theme') === 'dark';
      document.body.setAttribute('data-theme', isDark ? 'light' : 'dark');
      showToast(isDark ? 'Switched to Light Mode' : 'Switched to Dark Mode');
    });

    // --- Toast Utility ---
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.classList.add('show');
      setTimeout(() => t.classList.remove('show'), 3000);
    }

    // --- API Ready Callback ---
    function onYouTubeIframeAPIReady() {
      showToast('YouTube Player API Loaded âœ…');
    }

    // --- Video Loading Logic ---
    function loadVideo(forceId = null) {
      let inputVal = els.input.value.trim();
      let videoId = forceId || extractVideoId(inputVal);
      if (!videoId) {
        showToast('âš ï¸ Invalid YouTube URL or ID');
        return;
      }

      currentState.videoId = videoId;
      let startTime = 0;
      let statusMsg = '';

      if (els.settings.start.value) {
        startTime = Math.max(0, parseInt(els.settings.start.value) || 0);
        statusMsg = `â–¶ Starting at ${formatTime(startTime)}`;
      } else if (currentState.history[videoId] && currentState.history[videoId].time > 5) {
        startTime = Math.floor(currentState.history[videoId].time);
        statusMsg = `â–¶ Resuming from ${formatTime(startTime)}`;
      } else {
        statusMsg = 'â–¶ Starting from beginning';
      }

      els.status.innerHTML = statusMsg;

      if (player) {
        player.destroy();
        clearInterval(saveInterval);
      }

      const playerVars = {
        playsinline: 1,
        controls: els.settings.controls.checked ? 1 : 0,
        rel: 0,
        fs: 1,
        modestbranding: els.settings.modest.checked ? 1 : 0,
        start: startTime,
        loop: els.settings.loop.checked ? 1 : 0
      };

      if (els.settings.loop.checked) {
        playerVars.playlist = videoId;
      }

      player = new YT.Player('player', {
        videoId: videoId,
        playerVars: playerVars,
        events: {
          onReady: onPlayerReady,
          onStateChange: onPlayerStateChange,
          onError: (e) => showToast(`âŒ Video Error: ${e.data}`)
        }
      });

      updateHistoryEntry(videoId, startTime);
      els.input.value = `https://youtu.be/${videoId}`;
    }

    function onPlayerReady(event) {
      if (els.settings.autoplay.checked) {
        event.target.playVideo();
      }
      startSavingProgress();
    }

    function onPlayerStateChange(event) {
      if (event.data === YT.PlayerState.PLAYING) {
        startSavingProgress();
      } else {
        clearInterval(saveInterval);
      }
    }

    // --- Progress Saving ---
    function startSavingProgress() {
      clearInterval(saveInterval);
      saveInterval = setInterval(() => {
        if (player?.getCurrentTime) {
          const time = player.getCurrentTime();
          const duration = player.getDuration();
          if (time > 0 && duration > 0) {
            saveToHistory(currentState.videoId, time, duration);
          }
        }
      }, 5000);
    }

    function saveToHistory(id, time, duration) {
      if (!currentState.history[id]) currentState.history[id] = {};
      currentState.history[id] = {
        id,
        time,
        duration,
        lastPlayed: Date.now()
      };
      localStorage.setItem('yt_omni_pro_history', JSON.stringify(currentState.history));
      renderHistory();
    }

    // --- Helpers ---
    function extractVideoId(url) {
      if (!url) return null;
      const match = url.match(/(?:youtu\.be\/|v\/|embed\/|watch\?v=|&v=)([^&#]{11})/);
      return match ? match[1] : (url.length === 11 ? url : null);
    }

    function formatTime(seconds) {
      if (isNaN(seconds) || seconds <= 0) return '0:00';
      const h = Math.floor(seconds / 3600);
      const m = Math.floor((seconds % 3600) / 60);
      const s = Math.floor(seconds % 60);
      if (h > 0) return `${h}:${m.toString().padStart(2, '0')}:${s.toString().padStart(2, '0')}`;
      return `${m}:${s.toString().padStart(2, '0')}`;
    }

    // --- History UI ---
    function renderHistory() {
      const list = els.historyList;
      const history = currentState.history;

      if (!Object.keys(history).length) {
        list.innerHTML = '<li style="padding:14px; text-align:center; color:#9ca3af; font-size:0.9rem;">No viewing history yet.</li>';
        return;
      }

      const sorted = Object.values(history).sort((a, b) => b.lastPlayed - a.lastPlayed);
      list.innerHTML = '';

      sorted.forEach(item => {
        const percent = item.duration ? Math.min(100, (item.time / item.duration) * 100) : 0;
        const li = document.createElement('li');
        li.className = 'history-item';
        if (item.id === currentState.videoId) li.classList.add('watching-now');
        li.onclick = () => loadVideo(item.id);
        li.innerHTML = `
          <img src="https://img.youtube.com/vi/${item.id}/mqdefault.jpg" class="history-thumb" loading="lazy" onerror="this.src='https://placehold.co/120x90/333/999?text=No+Preview'">
          <div class="history-info">
            <div class="history-title">ID: ${item.id}</div>
            <div class="history-meta">
              <span>${formatTime(item.time)} / ${formatTime(item.duration || 0)}</span>
              <span>${new Date(item.lastPlayed).toLocaleDateString()}</span>
            </div>
            <div class="history-progress-bg">
              <div class="history-progress-fill" style="width: ${percent.toFixed(2)}%"></div>
            </div>
          </div>
          <div class="btn-del" onclick="deleteHistory(event, '${item.id}')">Ã—</div>
        `;
        list.appendChild(li);
      });
    }

    function updateHistoryEntry(id, time) {
      saveToHistory(id, time, 0);
    }

    function deleteHistory(e, id) {
      e.stopPropagation();
      delete currentState.history[id];
      localStorage.setItem('yt_omni_pro_history', JSON.stringify(currentState.history));
      renderHistory();
      showToast('History entry removed');
    }

    function wipeHistory() {
      if (confirm('ðŸ—‘ï¸ Are you sure you want to clear all watch history? This cannot be undone.')) {
        currentState.history = {};
        localStorage.removeItem('yt_omni_pro_history');
        renderHistory();
        showToast('All history cleared');
      }
    }

    function resetDefaults() {
      els.settings.autoplay.checked = true;
      els.settings.controls.checked = true;
      els.settings.loop.checked = false;
      els.settings.modest.checked = false;
      els.settings.start.value = '';
      showToast('Settings reset to default');
    }

    // --- Event Listeners ---
    document.getElementById('loadBtn').addEventListener('click', () => loadVideo());
    document.getElementById('applyBtn').addEventListener('click', () => {
      if (currentState.videoId) loadVideo(currentState.videoId);
      else showToast('âš ï¸ No video is currently loaded');
    });
    els.input.addEventListener('keypress', e => e.key === 'Enter' && loadVideo());

    // --- Init ---
    (() => {
      const saved = localStorage.getItem('yt_omni_pro_history');
      if (saved) {
        try {
          currentState.history = JSON.parse(saved);
        } catch (e) {
          console.warn('Failed to parse history');
        }
      }
      renderHistory();
    })();
  </script>
</body>
</html>

